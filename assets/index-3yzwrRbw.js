var $=Object.defineProperty;var P=(h,e,t)=>e in h?$(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var f=(h,e,t)=>P(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class x{constructor(e,t,s){f(this,"board");this.board={rows:e,cols:t,mines:s,cells:[],minesGenerated:!1},this.initializeBoard()}initializeBoard(){this.board.cells=[];for(let e=0;e<this.board.rows;e++){const t=[];for(let s=0;s<this.board.cols;s++)t.push({row:e,col:s,isMine:!1,adjacentMines:0,isRevealed:!1,isFlagged:!1});this.board.cells.push(t)}}getBoard(){return this.board}getCell(e,t){return this.isValidCell(e,t)?this.board.cells[e][t]:null}getNeighbors(e,t){const s=[],n=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[i,r]of n){const o=e+i,a=t+r;this.isValidCell(o,a)&&s.push(this.board.cells[o][a])}return s}getAdjacentMineCount(e,t){return this.getNeighbors(e,t).filter(n=>n.isMine).length}calculateAdjacentMines(){for(let e=0;e<this.board.rows;e++)for(let t=0;t<this.board.cols;t++){const s=this.board.cells[e][t];s.isMine||(s.adjacentMines=this.getAdjacentMineCount(e,t))}}setMine(e,t){return this.isValidCell(e,t)?(this.board.cells[e][t].isMine=!0,!0):!1}isValidCell(e,t){return e>=0&&e<this.board.rows&&t>=0&&t<this.board.cols}getForbiddenCells(e,t){const s=new Set;return this.getCell(e,t)&&(s.add(this.cellKey(e,t)),this.getNeighbors(e,t).forEach(i=>{s.add(this.cellKey(i.row,i.col))})),s}cellKey(e,t){return`${e},${t}`}clone(){const e=new x(this.board.rows,this.board.cols,this.board.mines);return e.board=JSON.parse(JSON.stringify(this.board)),e}setMinesGenerated(e){this.board.minesGenerated=e}areMinesGenerated(){return this.board.minesGenerated}getMineLocations(){const e=[];for(let t=0;t<this.board.rows;t++)for(let s=0;s<this.board.cols;s++)this.board.cells[t][s].isMine&&e.push({row:t,col:s});return e}getUnrevealedCount(){let e=0;for(let t=0;t<this.board.rows;t++)for(let s=0;s<this.board.cols;s++)this.board.cells[t][s].isRevealed||e++;return e}}class A{static generateMines(e,t,s){const n=e.getForbiddenCells(t,s),i=[],r=e.getBoard();for(let a=0;a<r.rows;a++)for(let l=0;l<r.cols;l++){const y=e.cellKey(a,l);n.has(y)||i.push({row:a,col:l})}const o=this.shuffleArray(i);for(let a=0;a<r.mines&&a<o.length;a++){const{row:l,col:y}=o[a];e.setMine(l,y)}e.calculateAdjacentMines(),e.setMinesGenerated(!0)}static shuffleArray(e){const t=[...e];for(let s=t.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[t[s],t[n]]=[t[n],t[s]]}return t}static getEmptyRegion(e,t,s){const n=e.getCell(t,s);if(!n||n.isMine||n.adjacentMines>0)return new Set([e.cellKey(t,s)]);const i=new Set,r=[{row:t,col:s}],o=new Set;for(;r.length>0;){const{row:a,col:l}=r.shift(),y=e.cellKey(a,l);if(o.has(y))continue;o.add(y);const b=e.getCell(a,l);if(!(!b||b.isMine)&&(i.add(y),b.adjacentMines===0)){const L=e.getNeighbors(a,l);for(const M of L){const G=e.cellKey(M.row,M.col);o.has(G)||r.push({row:M.row,col:M.col})}}}return i}}class j{constructor(e,t,s){f(this,"board");f(this,"gameState");f(this,"timerInterval",null);f(this,"listeners",new Map);this.board=new x(e,t,s),this.gameState={board:this.board.getBoard(),status:"playing",elapsedTime:0,minesRemaining:s,cellsRevealed:0,hasUsedUndo:!1}}revealCell(e,t){if(this.gameState.status!=="playing")return!1;const s=this.board.getCell(e,t);return!s||s.isRevealed||s.isFlagged?!1:(this.board.areMinesGenerated()||(A.generateMines(this.board,e,t),this.startTimer()),this.reveal(e,t))}reveal(e,t,s=!1){const n=this.board.getCell(e,t);if(!n||n.isRevealed||n.isFlagged)return!1;if(n.isRevealed=!0,this.gameState.cellsRevealed++,this.emit("cell-revealed",{row:e,col:t}),n.isMine)return this.endGame("lost"),this.revealAllMines(),!1;if(n.adjacentMines===0&&!s){const i=A.getEmptyRegion(this.board,e,t);for(const r of i){const[o,a]=r.split(",").map(Number);(o!==e||a!==t)&&this.reveal(o,a,!0)}}return this.checkWin()&&this.endGame("won"),!0}toggleFlag(e,t){if(this.gameState.status!=="playing")return!1;const s=this.board.getCell(e,t);return!s||s.isRevealed?!1:(s.isFlagged=!s.isFlagged,this.gameState.minesRemaining+=s.isFlagged?-1:1,this.emit("flag-toggled",{row:e,col:t,isFlagged:s.isFlagged}),!0)}chord(e,t){if(this.gameState.status!=="playing")return!1;const s=this.board.getCell(e,t);if(!s||!s.isRevealed||s.adjacentMines===0)return!1;const n=this.board.getNeighbors(e,t);if(n.filter(o=>o.isFlagged).length!==s.adjacentMines)return!1;let r=!1;for(const o of n)!o.isRevealed&&!o.isFlagged&&this.reveal(o.row,o.col,!1)&&(r=!0);return r}checkWin(){const e=this.board.getBoard(),t=e.rows*e.cols-e.mines;return this.gameState.cellsRevealed===t}endGame(e){this.stopTimer(),this.emit(`game-${e}`,{time:this.gameState.elapsedTime,hasUsedUndo:this.gameState.hasUsedUndo})}revealAllMines(){const e=this.board.getMineLocations();for(const{row:t,col:s}of e){const n=this.board.getCell(t,s);n&&!n.isRevealed&&(n.isRevealed=!0,this.emit("mine-revealed",{row:t,col:s}))}}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}startTimer(){this.timerInterval||(this.timerInterval=setInterval(()=>{this.gameState.elapsedTime++,this.gameState.elapsedTime>9999&&(this.gameState.elapsedTime=9999,this.stopTimer()),this.emit("timer-update",{elapsedTime:this.gameState.elapsedTime})},1e3))}newGame(e,t,s){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.board=new x(e,t,s),this.gameState={board:this.board.getBoard(),status:"playing",elapsedTime:0,minesRemaining:s,cellsRevealed:0,hasUsedUndo:!1},this.emit("new-game",{})}getState(){return{...this.gameState,board:this.board.getBoard()}}restoreState(e){this.gameState=JSON.parse(JSON.stringify(e)),this.board=new x(e.board.rows,e.board.cols,e.board.mines),this.board.board=JSON.parse(JSON.stringify(e.board)),this.stopTimer(),this.gameState.status==="playing"&&this.gameState.board.minesGenerated&&this.startTimer(),this.emit("state-restored",{})}markUndoUsed(){this.gameState.hasUsedUndo=!0}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}emit(e,t){if(this.listeners.has(e))for(const s of this.listeners.get(e))s(t)}destroy(){this.stopTimer(),this.listeners.clear()}}class _{constructor(e,t){f(this,"container");f(this,"gameEngine");f(this,"boardElement",null);f(this,"timerElement",null);f(this,"counterElement",null);f(this,"statusElement",null);f(this,"messageElement",null);f(this,"messageAlertElement",null);f(this,"probabilities",{});f(this,"learningModeEnabled",!1);f(this,"cellMap",new Map);this.container=e,this.gameEngine=t,this.cacheElements(),this.setupEventListeners()}cacheElements(){this.timerElement=document.getElementById("timer"),this.counterElement=document.getElementById("counter"),this.statusElement=document.getElementById("status"),this.messageElement=document.getElementById("message"),this.messageAlertElement=document.getElementById("message-alert")}setupEventListeners(){this.gameEngine.on("cell-revealed",e=>this.updateCell(e.row,e.col)),this.gameEngine.on("flag-toggled",e=>this.updateCell(e.row,e.col)),this.gameEngine.on("timer-update",e=>this.updateTimer(e.elapsedTime)),this.gameEngine.on("mine-revealed",e=>this.updateCell(e.row,e.col)),this.gameEngine.on("game-won",e=>this.onGameWon(e)),this.gameEngine.on("game-lost",()=>this.onGameLost()),this.gameEngine.on("new-game",()=>this.renderBoard()),this.gameEngine.on("state-restored",()=>this.renderBoard())}renderBoard(){const e=this.gameEngine.getState();e.board.minesGenerated||(this.probabilities={}),this.boardElement||(this.boardElement=document.createElement("div"),this.boardElement.id="game-board",this.boardElement.className="board",this.container.appendChild(this.boardElement),this.setupBoardInteractions()),this.boardElement.innerHTML="",this.boardElement.style.gridTemplateColumns=`repeat(${e.board.cols}, 1fr)`,this.cellMap.clear();const t=document.createDocumentFragment();for(let s=0;s<e.board.rows;s++)for(let n=0;n<e.board.cols;n++){const i=e.board.cells[s][n],r=this.createCellElement(i,s,n);this.cellMap.set(`${s},${n}`,r),t.appendChild(r)}this.boardElement.appendChild(t),this.updateInfo(e)}setupBoardInteractions(){if(!this.boardElement)return;const e=u=>u.target.closest(".cell"),t=u=>{const d=parseInt(u.dataset.row||"-1"),m=parseInt(u.dataset.col||"-1");return d>=0&&m>=0?{row:d,col:m}:null};let s=0,n=0,i=0,r=!1,o=!1,a=!1,l=null,y=!1,b=null;const L=400,M=300,G=15;this.boardElement.addEventListener("mousedown",u=>{if(e(u)&&this.gameEngine.getState().status==="playing"){const m=document.getElementById("status");m&&(m.textContent="ðŸ˜®")}}),this.boardElement.addEventListener("mouseup",()=>{const u=document.getElementById("status");if(u){const d=this.gameEngine.getState();u.textContent=d.status==="won"?"ðŸ˜Ž":d.status==="lost"?"ðŸ˜µ":"ðŸ˜Š"}}),this.boardElement.addEventListener("mouseleave",()=>{const u=document.getElementById("status");if(u){const d=this.gameEngine.getState();u.textContent=d.status==="won"?"ðŸ˜Ž":d.status==="lost"?"ðŸ˜µ":"ðŸ˜Š"}}),this.boardElement.addEventListener("click",u=>{if(o){u.preventDefault(),u.stopPropagation(),o=!1;return}const d=e(u);if(!d)return;const m=t(d);m&&this.gameEngine.getState().status==="playing"&&this.gameEngine.revealCell(m.row,m.col)}),this.boardElement.addEventListener("contextmenu",u=>{if(u.preventDefault(),o||a)return;const d=e(u);if(!d)return;const m=t(d);m&&this.gameEngine.getState().status==="playing"&&this.gameEngine.toggleFlag(m.row,m.col)}),this.boardElement.addEventListener("dblclick",u=>{u.preventDefault();const d=e(u);if(!d)return;const m=t(d);m&&this.gameEngine.getState().status==="playing"&&this.gameEngine.chord(m.row,m.col)}),this.boardElement.addEventListener("touchstart",u=>{const d=e(u);!d||this.gameEngine.getState().status!=="playing"||(a=!0,b=d,r=!1,y=!1,n=u.touches[0]?.clientX??0,i=u.touches[0]?.clientY??0,d.style.opacity="0.7",d.style.transform="scale(0.95)",l!==null&&(window.clearTimeout(l),l=null),l=window.setTimeout(()=>{if(!r&&!y&&b===d){y=!0,l=null,d.style.opacity="1",d.style.transform="";const m=t(d);m&&(this.gameEngine.toggleFlag(m.row,m.col),navigator.vibrate&&navigator.vibrate(50))}},L))},{passive:!0}),this.boardElement.addEventListener("touchmove",u=>{if(!b)return;const d=u.touches[0]?.clientX??0,m=u.touches[0]?.clientY??0,H=Math.abs(d-n),c=Math.abs(m-i);(H>G||c>G)&&(r=!0,b.style.opacity="1",b.style.transform="",l!==null&&(window.clearTimeout(l),l=null))},{passive:!0}),this.boardElement.addEventListener("touchend",u=>{if(a=!1,!b)return;const d=b;if(b=null,this.gameEngine.getState().status!=="playing")return;if(l!==null&&(window.clearTimeout(l),l=null),d.style.opacity="1",d.style.transform="",r){r=!1,y=!1;return}if(y){y=!1,u.preventDefault(),o=!0,window.setTimeout(()=>{o=!1},500);return}u.preventDefault(),o=!0,window.setTimeout(()=>{o=!1},500);const m=Date.now(),H=m-s;s=m;const c=t(d);c&&(H>0&&H<=M?(y=!0,this.gameEngine.chord(c.row,c.col)):(y=!0,this.gameEngine.revealCell(c.row,c.col)))},{passive:!1}),this.boardElement.addEventListener("touchcancel",()=>{a=!1,l!==null&&(window.clearTimeout(l),l=null),b&&(b.style.opacity="1",b.style.transform="",b=null),r=!1,o=!1,y=!1})}createCellElement(e,t,s){const n=document.createElement("div");return n.className="cell",n.id=`cell-${t}-${s}`,n.dataset.row=String(t),n.dataset.col=String(s),this.updateCellDisplay(n,e),n}updateCell(e,t){const s=this.gameEngine.getState(),n=s.board.cells[e][t],i=this.cellMap.get(`${e},${t}`);i&&n&&this.updateCellDisplay(i,n),s.status==="playing"&&this.updateCounter(s.minesRemaining)}updateCellDisplay(e,t){if(e.textContent="",e.className="cell",t.isRevealed)e.classList.add("revealed"),t.isMine?(e.textContent="ðŸ’£",e.classList.add("mine")):t.adjacentMines>0&&(e.textContent=String(t.adjacentMines),e.classList.add(`number-${t.adjacentMines}`));else if(e.classList.add("unrevealed"),t.isFlagged)e.textContent="ðŸš©",e.classList.add("flagged");else if(this.learningModeEnabled){const s=`${t.row},${t.col}`,n=this.probabilities[s];if(n!==void 0){const i=Math.round(n*100),r=document.createElement("span");r.className="probability",r.textContent=`${i}%`,n===0?r.classList.add("prob-safe"):n===1?r.classList.add("prob-mine"):n<.3?r.classList.add("prob-low"):n<.7?r.classList.add("prob-medium"):r.classList.add("prob-high"),e.appendChild(r)}}}updateTimer(e){if(this.timerElement){const t=Math.min(e,9999);this.timerElement.textContent=String(t).padStart(3,"0")}}updateCounter(e){if(this.counterElement){const t=Math.max(0,Math.min(e,999));this.counterElement.textContent=String(t).padStart(3,"0")}}updateInfo(e){this.updateTimer(e.elapsedTime),this.updateCounter(e.minesRemaining),this.updateStatus(e.status)}updateStatus(e){this.statusElement&&(e==="playing"?this.statusElement.textContent="ðŸ˜Š":e==="won"?this.statusElement.textContent="ðŸ˜Ž":e==="lost"&&(this.statusElement.textContent="ðŸ˜µ"))}onGameWon(e){this.updateStatus("won"),this.boardElement&&this.boardElement.classList.add("game-won"),this.messageElement&&(this.messageAlertElement&&(this.messageAlertElement.textContent=`You won! Time: ${e.time}s ${e.hasUsedUndo?"(with undo)":""}`),this.messageElement.style.color="green",this.messageElement.classList.add("has-alert"))}onGameLost(){this.updateStatus("lost"),this.boardElement&&this.boardElement.classList.add("game-lost"),this.messageElement&&(this.messageAlertElement&&(this.messageAlertElement.textContent="Game Over! You hit a mine."),this.messageElement.style.color="red",this.messageElement.classList.add("has-alert"))}clearMessage(){this.messageElement&&(this.messageAlertElement&&(this.messageAlertElement.textContent=""),this.messageElement.style.color="inherit",this.messageElement.classList.remove("has-alert")),this.boardElement&&this.boardElement.classList.remove("game-won","game-lost")}disableBoard(e=!0){this.boardElement&&(this.boardElement.style.pointerEvents=e?"none":"auto",this.boardElement.style.opacity=e?"0.5":"1")}updateProbabilities(e){if(this.probabilities=e,this.learningModeEnabled){const t=this.gameEngine.getState();for(let s=0;s<t.board.rows;s++)for(let n=0;n<t.board.cols;n++){const i=t.board.cells[s][n];!i.isRevealed&&!i.isFlagged&&this.updateCell(s,n)}}}setLearningMode(e,t){if(this.learningModeEnabled=e,e&&t)this.updateProbabilities(t);else if(!e){this.probabilities={};const s=this.gameEngine.getState();for(let n=0;n<s.board.rows;n++)for(let i=0;i<s.board.cols;i++){const r=s.board.cells[n][i];if(!r.isRevealed&&!r.isFlagged){const o=this.cellMap.get(`${n},${i}`);if(o){const a=o.querySelector(".probability");a&&o.removeChild(a)}}}}}destroy(){}}const k={easy:{rows:9,cols:9,mines:10},medium:{rows:16,cols:16,mines:40},custom:{rows:16,cols:16,mines:99}};function U(h){return k[h]||null}function O(){return Object.keys(k)}function z(h){return h.rows>=5&&h.rows<=50&&h.cols>=5&&h.cols<=50&&h.mines>0&&h.mines<h.rows*h.cols}const T={SETTINGS:"minesweeper_settings",HIGH_SCORES:"minesweeper_high_scores",CURRENT_GAME:"minesweeper_current_game"};class C{static loadSettings(){try{const e=localStorage.getItem(T.SETTINGS);if(e){const t=JSON.parse(e);return t.currentDifficulty==="hard"&&(t.currentDifficulty="custom"),t.customConfig||(t.customConfig=C.getDefaultSettings().customConfig),t}}catch(e){console.error("Error loading settings:",e)}return C.getDefaultSettings()}static saveSettings(e){try{localStorage.setItem(T.SETTINGS,JSON.stringify(e))}catch(t){console.error("Error saving settings:",t)}}static getDefaultSettings(){return{currentDifficulty:"easy",soundEnabled:!1,theme:"classic",customConfig:{rows:16,cols:16,mines:99},learningModeEnabled:!1}}static loadHighScores(){try{const e=localStorage.getItem(T.HIGH_SCORES);if(e)return JSON.parse(e).sort((s,n)=>s.time-n.time)}catch(e){console.error("Error loading high scores:",e)}return[]}static saveHighScore(e){try{const t=C.loadHighScores();t.push(e);const s=new Map;for(const i of t)s.has(i.difficulty)||s.set(i.difficulty,[]),s.get(i.difficulty).push(i);const n=[];for(const[i,r]of s)r.sort((o,a)=>o.time-a.time),n.push(...r.slice(0,10));localStorage.setItem(T.HIGH_SCORES,JSON.stringify(n))}catch(t){console.error("Error saving high score:",t)}}static getHighScoresForDifficulty(e){return C.loadHighScores().filter(s=>s.difficulty===e).slice(0,10)}static saveCurrentGame(e,t){try{const s={state:e,difficulty:t,timestamp:Date.now()};localStorage.setItem(T.CURRENT_GAME,JSON.stringify(s))}catch(s){console.error("Error saving current game:",s)}}static loadCurrentGame(){try{const e=localStorage.getItem(T.CURRENT_GAME);if(e){const t=JSON.parse(e);return t.difficulty==="hard"&&(t.difficulty="custom"),t}}catch(e){console.error("Error loading current game:",e)}return null}static clearCurrentGame(){try{localStorage.removeItem(T.CURRENT_GAME)}catch(e){console.error("Error clearing current game:",e)}}static isAvailable(){try{const e="__ls_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}}class J{static calculateProbabilities(e,t){const s=e.getBoard(),n={},i=new Set,r=[],o=new Set,a=new Set;for(let c=0;c<s.rows;c++)for(let v=0;v<s.cols;v++){const p=e.getCell(c,v);if(p&&(!p.isRevealed&&!p.isFlagged&&i.add(e.cellKey(c,v)),p.isRevealed&&p.adjacentMines>0)){const S=e.getNeighbors(c,v),E=S.filter(w=>!w.isRevealed&&!w.isFlagged),g=S.filter(w=>w.isFlagged),I=p.adjacentMines-g.length;E.length>0&&I>=0&&r.push({cells:E.map(w=>e.cellKey(w.row,w.col)),mines:I})}}let l=!0,y=0;const b=100;for(;l&&y<b;){l=!1,y++;for(const p of r){let S=p.mines;const E=[];for(const g of p.cells)if(!o.has(g)){if(a.has(g)){S-=1;continue}E.push(g)}if(S=Math.max(0,S),p.cells=E,p.mines=S,E.length!==0){if(S===0)for(const g of E)o.has(g)||(o.add(g),l=!0);else if(S===E.length)for(const g of E)a.has(g)||(a.add(g),l=!0)}}const c=[],v=Math.min(r.length,50);for(let p=0;p<v;p++){const S=r[p];if(S.cells.length!==0)for(let E=0;E<r.length;E++){if(p===E)continue;const g=r[E];if(g.cells.length===0)continue;const I=new Set(S.cells),w=new Set(g.cells);if(S.cells.every(D=>w.has(D))&&S.cells.length<g.cells.length){const D=g.cells.filter(B=>!I.has(B)),N=g.mines-S.mines;if(D.length>0&&N>=0)if(N===0)for(const B of D)!o.has(B)&&!a.has(B)&&(o.add(B),l=!0);else if(N===D.length)for(const B of D)!a.has(B)&&!o.has(B)&&(a.add(B),l=!0);else c.some(R=>R.cells.length!==D.length||R.mines!==N?!1:R.cells.every(F=>D.includes(F)))||c.push({cells:D,mines:N})}}}c.length>0&&(r.push(...c),l=!0)}for(const c of o)n[c]=0;for(const c of a)n[c]=1;const L=r.filter(c=>c.cells.length>0),M=new Set;for(const c of L)for(const v of c.cells)!o.has(v)&&!a.has(v)&&M.add(v);const G=this.partitionConstraints(L);for(const c of G){const v=new Set;for(const S of c)for(const E of S.cells)v.add(E);const p=Array.from(v);if(p.length>0&&p.length<=20){const S=this.solveConstraints(p,c);if(S.length>0){const E={};for(const g of p)E[g]=0;for(const g of S)for(const I of g)E[I]++;for(const g of p)n[g]=E[g]/S.length}else for(const E of p)n[E]=.5}else if(p.length>20){const S={},E={};for(const g of c){const I=g.mines/g.cells.length;for(const w of g.cells)S[w]=(S[w]||0)+I,E[w]=(E[w]||0)+1}for(const g of p)if(n[g]===void 0){const I=E[g]>0?S[g]/E[g]:.5;n[g]=Math.max(0,Math.min(1,I))}}}const u=Math.max(0,t-a.size);let d=0;for(const c of M)d+=n[c]||0;const m=[];if(i.forEach(c=>{!M.has(c)&&n[c]===void 0&&m.push(c)}),m.length>0){const v=Math.max(0,u-d)/m.length;for(const p of m)n[p]=Math.max(0,Math.min(1,v))}const H=i.size>0?u/i.size:0;return i.forEach(c=>{n[c]===void 0&&(n[c]=Math.max(0,Math.min(1,H)))}),n}static partitionConstraints(e){if(e.length===0)return[];const t=new Map;e.forEach((o,a)=>{for(const l of o.cells)t.has(l)||t.set(l,[]),t.get(l).push(a)});const s=new Array(e.length).fill(0).map((o,a)=>a),n=o=>(s[o]!==o&&(s[o]=n(s[o])),s[o]),i=(o,a)=>{const l=n(o),y=n(a);l!==y&&(s[l]=y)};for(const o of t.values())for(let a=1;a<o.length;a++)i(o[0],o[a]);const r=new Map;return e.forEach((o,a)=>{const l=n(a);r.has(l)||r.set(l,[]),r.get(l).push(o)}),Array.from(r.values())}static solveConstraints(e,t){const s=[],n=e.length,i=Math.pow(2,n);if(i>1048576)return[];const r=1e4;for(let o=0;o<i&&!(s.length>=r);o++){const a=[];for(let b=0;b<n;b++)o&1<<b&&a.push(e[b]);const l=new Set(a);let y=!0;for(const b of t)if(b.cells.filter(M=>l.has(M)).length!==b.mines){y=!1;break}y&&s.push(a)}return s}static getDefinitiveCells(e,t){const s=this.calculateProbabilities(e,t),n=[],i=[];for(const[r,o]of Object.entries(s)){const[a,l]=r.split(",").map(Number);o===0?n.push({row:a,col:l}):o===1&&i.push({row:a,col:l})}return{safe:n,mines:i}}}class K{constructor(e,t,s){f(this,"gameEngine");f(this,"renderer");f(this,"stateManager");f(this,"currentDifficulty","easy");f(this,"customConfig");f(this,"learningModeEnabled",!1);this.gameEngine=e,this.renderer=t,this.stateManager=s;const n=C.loadSettings();this.currentDifficulty=n.currentDifficulty,this.customConfig=n.customConfig||{rows:30,cols:16,mines:99},this.learningModeEnabled=n.learningModeEnabled||!1,this.setupControls(),this.setupGameEngineListeners()}setupControls(){const e=O();for(const a of e){const l=document.getElementById(`difficulty-${a}`);l&&l.addEventListener("click",()=>this.selectDifficulty(a))}const t=document.getElementById("status");t&&t.addEventListener("click",()=>this.newGame());const s=document.getElementById("undo-btn-header");s&&s.addEventListener("click",()=>this.undo());const n=document.getElementById("restart-btn");n&&n.addEventListener("click",()=>this.newGame());const i=document.getElementById("learning-mode-toggle");i&&(i.checked=this.learningModeEnabled,i.addEventListener("change",()=>{this.toggleLearningMode(i.checked)}));const r=document.getElementById("custom-cancel");r&&r.addEventListener("click",()=>this.closeCustomDialog());const o=document.getElementById("custom-start");o&&o.addEventListener("click",()=>this.applyCustomDialog()),this.updateDifficultyButtons(),this.updateCustomLabel()}setupGameEngineListeners(){this.gameEngine.on("cell-revealed",()=>{this.learningModeEnabled&&this.updateProbabilities()}),this.gameEngine.on("flag-toggled",()=>{this.learningModeEnabled&&this.updateProbabilities()}),this.gameEngine.on("new-game",()=>{this.learningModeEnabled&&this.updateProbabilities()}),this.gameEngine.on("state-restored",()=>{this.learningModeEnabled&&this.updateProbabilities()})}selectDifficulty(e){if(e==="custom"){this.openCustomDialog();return}this.currentDifficulty=e;const t=C.loadSettings();t.currentDifficulty=e,C.saveSettings(t),this.stateManager.clear(),this.newGame(),this.updateDifficultyButtons()}updateDifficultyButtons(){const e=O();for(const t of e){const s=document.getElementById(`difficulty-${t}`);s&&(t===this.currentDifficulty?s.classList.add("active"):s.classList.remove("active"))}}newGame(){let e=U(this.currentDifficulty);this.currentDifficulty==="custom"&&(e=this.customConfig),e&&(this.stateManager.clear(),this.renderer.clearMessage(),this.gameEngine.newGame(e.rows,e.cols,e.mines),this.renderer.renderBoard(),this.stateManager.saveState(this.gameEngine.getState()),this.updateUndoButton())}undo(){const e=this.stateManager.undo();e&&(this.gameEngine.getState().hasUsedUndo=!0,this.gameEngine.restoreState(e),this.renderer.clearMessage(),this.renderer.renderBoard(),this.updateUndoButton())}updateUndoButton(){const e=document.getElementById("undo-btn-header"),t=this.stateManager.canUndo();e&&(e.disabled=!t)}saveState(){const e=this.gameEngine.getState();this.stateManager.saveState(e),this.updateUndoButton()}getCurrentDifficulty(){return this.currentDifficulty}openCustomDialog(){const e=document.getElementById("custom-modal"),t=document.getElementById("custom-rows"),s=document.getElementById("custom-cols"),n=document.getElementById("custom-mines"),i=document.getElementById("custom-error");!e||!t||!s||!n||(t.value=String(this.customConfig.rows),s.value=String(this.customConfig.cols),n.value=String(this.customConfig.mines),i&&(i.textContent=""),e.classList.add("is-open"),e.setAttribute("aria-hidden","false"))}closeCustomDialog(){const e=document.getElementById("custom-modal");e&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"))}applyCustomDialog(){const e=document.getElementById("custom-rows"),t=document.getElementById("custom-cols"),s=document.getElementById("custom-mines"),n=document.getElementById("custom-error");if(!e||!t||!s)return;const i=Number(e.value),r=Number(t.value),o=Number(s.value),a={rows:i,cols:r,mines:o};if(!z(a)){n&&(i<5||i>50||r<5||r>50?n.textContent="Board size must be 5-50 for both rows and columns.":o<=0||o>=i*r?n.textContent=`Mines must be between 1 and ${i*r-1}.`:n.textContent="Invalid settings. Check sizes and mine count.");return}this.customConfig=a,this.currentDifficulty="custom";const l=C.loadSettings();l.currentDifficulty="custom",l.customConfig=a,C.saveSettings(l),this.closeCustomDialog(),this.newGame(),this.updateDifficultyButtons(),this.updateCustomLabel()}updateCustomLabel(){const e=document.getElementById("difficulty-custom");e&&(e.textContent=`Custom (${this.customConfig.rows}x${this.customConfig.cols})`)}resumeGame(){const e=C.loadCurrentGame();if(!e)return!1;const t=Date.now()-e.timestamp,s=24*60*60*1e3;if(t>s)return C.clearCurrentGame(),!1;if(this.currentDifficulty=e.difficulty,this.currentDifficulty==="custom"){const n=C.loadSettings();n.customConfig&&(this.customConfig=n.customConfig)}return this.gameEngine.restoreState(e.state),this.renderer.renderBoard(),this.stateManager.clear(),this.stateManager.saveState(e.state),this.updateUndoButton(),this.updateDifficultyButtons(),this.updateCustomLabel(),!0}toggleLearningMode(e){this.learningModeEnabled=e;const t=C.loadSettings();t.learningModeEnabled=e,C.saveSettings(t),e?this.updateProbabilities():this.renderer.setLearningMode(!1)}updateProbabilities(){if(!this.learningModeEnabled)return;const e=this.gameEngine.getState();if(e.status!=="playing"||!e.board.minesGenerated)return;const t=new x(e.board.rows,e.board.cols,e.board.mines);t.getBoard().cells=e.board.cells,t.getBoard().minesGenerated=e.board.minesGenerated;const s=J.calculateProbabilities(t,e.minesRemaining);this.renderer.setLearningMode(!0,s)}destroy(){}}class Y{constructor(){f(this,"stateHistory",[]);f(this,"maxHistorySize",100)}saveState(e){const t=JSON.parse(JSON.stringify(e));this.stateHistory.push(t),this.stateHistory.length>this.maxHistorySize&&this.stateHistory.shift()}undo(){return this.stateHistory.length<2?null:(this.stateHistory.pop(),this.stateHistory[this.stateHistory.length-1])}canUndo(){return this.stateHistory.length>=2}getCurrentState(){return this.stateHistory.length===0?null:this.stateHistory[this.stateHistory.length-1]}clear(){this.stateHistory=[]}getHistorySize(){return this.stateHistory.length}setMaxHistorySize(e){for(this.maxHistorySize=Math.max(1,e);this.stateHistory.length>this.maxHistorySize;)this.stateHistory.shift()}}class V{constructor(){f(this,"gameEngine");f(this,"renderer");f(this,"controls");f(this,"stateManager");this.stateManager=new Y;const e=C.loadSettings();let t=U(e.currentDifficulty);if(e.currentDifficulty==="custom"&&e.customConfig&&(t=e.customConfig),!t)throw new Error(`Invalid difficulty: ${e.currentDifficulty}`);this.gameEngine=new j(t.rows,t.cols,t.mines);const s=document.getElementById("board-container-inner");if(!s)throw new Error("Board container not found");this.renderer=new _(s,this.gameEngine),this.controls=new K(this.gameEngine,this.renderer,this.stateManager),this.setupStateManagement(),this.controls.resumeGame()||this.renderer.renderBoard(),this.displayHighScores()}setupStateManagement(){this.gameEngine.on("cell-revealed",()=>{this.controls.saveState();const e=this.gameEngine.getState();C.saveCurrentGame(e,this.controls.getCurrentDifficulty())}),this.gameEngine.on("flag-toggled",()=>{this.controls.saveState();const e=this.gameEngine.getState();C.saveCurrentGame(e,this.controls.getCurrentDifficulty())}),this.gameEngine.on("game-won",e=>{if(!e.hasUsedUndo){const t=this.controls.getCurrentDifficulty();C.saveHighScore({difficulty:t,time:e.time,timestamp:Date.now()}),this.displayHighScores()}C.clearCurrentGame()}),this.gameEngine.on("game-lost",()=>{C.clearCurrentGame()}),this.gameEngine.on("timer-update",e=>{if(e.elapsedTime%10===0){const t=this.gameEngine.getState();C.saveCurrentGame(t,this.controls.getCurrentDifficulty())}})}displayHighScores(){const e=["easy","medium","custom"];for(const t of e){const s=C.getHighScoresForDifficulty(t),n=document.getElementById(`${t}-scores`);if(n)if(n.innerHTML="",s.length===0){const i=document.createElement("li");i.textContent="No scores yet",n.appendChild(i)}else s.forEach(i=>{const r=document.createElement("li");r.textContent=`${i.time}s`,n.appendChild(r)})}}destroy(){this.gameEngine.destroy(),this.renderer.destroy(),this.controls.destroy()}}document.addEventListener("DOMContentLoaded",()=>{try{const h=new V;window.app=h,window.addEventListener("beforeunload",()=>{h.destroy()}),console.log("Minesweeper game initialized successfully")}catch(h){console.error("Failed to initialize game:",h);const e=document.getElementById("app");e&&(e.innerHTML=`<div style="color: red; padding: 20px;">
        Error initializing game: ${h instanceof Error?h.message:"Unknown error"}
      </div>`)}});
